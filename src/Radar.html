<svg version="1.1" viewBox="0 0 100 100" preserveAspectRatio="xMinYMin meet">
  {#each disciplinesAnnotated as discipline}
    {#each discipline.practices as practice}
      <Slice
        startRadians={practice.startRadians}
        endRadians={practice.endRadians}
        outerRadius={outerRadius-disciplineBandHeight}
        levels={practice.levels}
        label={practice.practice}
      />
    {/each}

    <!-- Dicipline Label -->
    <Arc
      startRadians={discipline.startRadians}
      endRadians={discipline.endRadians}
      innerRadius={outerRadius-disciplineBandHeight}
      {outerRadius}
      fill="none"
      strokeWidth={strokeWidth*2}
      stroke={disciplineStroke}
      label={discipline.discipline}
      fontColor={diciplineFontColor}
    />

    <!-- Dicipline Area Arc -->
    <Arc startRadians={discipline.startRadians} endRadians={discipline.endRadians} {outerRadius} {innerRadius} fill="none" strokeWidth={strokeWidth*2} stroke={disciplineStroke}/>

  {/each}

</svg>

<script>

  export default {
    data() {
      return {
        practiceStroke: "#999999",
        disciplineStroke: "#555555",
        strokeWidth: 0.15,
        baseColor: "#2E8468",
        fontColor: "#22644E",
        diciplineFontColor: "#184738",
        innerRadius: 10,
        outerRadius: 49,

        label: "Label",
        labelBandHeight: 5,
        disciplineBandHeight: 7,
        disciplines: [
          {
            discipline: "Artisanship",
            practices: [
              {practice: "Yellow belt", description: "100% of group members... Yellow Belt training", levels: [
                {portion: 4},
                {portion: 2},
                {portion: 2},
                {portion: 1},
                {portion: 1},
              ]},
              {practice: "Green belt", description: "At least one Green Belt...", levels: [
                {portion: 0},
                {portion: 0},
                {portion: 0},
                {portion: 2},
                {portion: 7},
              ]},
            ]
          },
          {
            discipline: "Architecture & Design",
            practices: [
              {practice: "Threat modeling", description: "blah blah", levels: [
                {portion: 4},
                {portion: 2},
                {portion: 2},
                {portion: 1},
                {portion: 1},
              ]},
            ]
          },
          {
            discipline: "DevSecOps Tools",
            practices: [
              {practice: "PCA in pipeline", description: "blah, blah", levels: [
                {portion: 2},
                {portion: 2},
                {portion: 4},
                {portion: 1},
                {portion: 1},
              ]},
              {practice: "SCA in pipeline", description: "blah, blah", levels: [
                {portion: 7},
                {portion: 0},
                {portion: 1},
                {portion: 1},
                {portion: 1},
              ]},
              {practice: "Working agreements", description: "blah, blah", levels: [
                {portion: 2},
                {portion: 2},
                {portion: 1},
                {portion: 3},
                {portion: 0},
              ]},
            ]
          },

        ]
      }
    },

    computed: {
      // junk: (s) => {
      //   console.log(s.disciplinesAnnotated)
      // },
      // For the actual arc area
      // p1x: ({innerRadius, centerX, startRadians}) => centerX + (innerRadius * Math.sin(startRadians)),
      disciplinesAnnotated: ({disciplines}) => {
        let disciplinesAnnotated = disciplines
        let practiceCount = 0
        for (let discipline of disciplines) {
          for (let practice of discipline.practices) {
            practiceCount++
          }
        }

        let sliceWidth = Math.PI * 2 / practiceCount

        let currentAngle = 0
        for (let discipline of disciplines) {
          discipline.startRadians = currentAngle
          for (let practice of discipline.practices) {
            practice.startRadians = currentAngle
            currentAngle += sliceWidth
            practice.endRadians = currentAngle
          }
          discipline.endRadians = currentAngle
        }

        return disciplinesAnnotated
      },

    },

    components: {
      Slice: './Slice.html',
      Arc: './Arc.html',
    },

  }

</script>
