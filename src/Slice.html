<g>
  <!-- Label Arc -->
  <Arc {centerX} {centerY} {startRadians} {endRadians} innerRadius={dataOuterRadius} {outerRadius} {label} {fontColor} {fontSize} {strokeWidth} fill="none" {stroke} />

  <!-- Level Arcs -->
  {#each levelsAnnotated as level}
    <Arc {centerX} {centerY} {startRadians} {endRadians} innerRadius={level.innerRadius} outerRadius={level.outerRadius} fill={baseColor} opacity={level.opacity} stroke="none" />
  {/each}

  <!-- Data Area Arc -->
  <Arc {centerX} {centerY} {startRadians} {endRadians} {innerRadius} outerRadius={dataOuterRadius} {strokeWidth} fill="none" {stroke} />

  {#if goal}
    <Goal {centerX} {centerY} {startRadians} {endRadians} {goalRadius} {levelsAnnotated} {goal}/>
  {/if}

</g>

<script>

  export default {

    namespace: 'svg',

    data() {
      return {
      }
    },

    computed: {
      // junk: (s) => {
      //   console.log(s.goal)
      // },
      // For the actual arc area
      // p1x: ({innerRadius, centerX, startRadians}) => centerX + (innerRadius * Math.sin(startRadians)),
      dataOuterRadius: ({outerRadius, labelBandHeight}) => outerRadius - labelBandHeight,
      goalRadius: ({innerRadius, dataOuterRadius, goal}) => {
        // console.log(goal)
        if (goal) {
          return innerRadius + (dataOuterRadius - innerRadius) * goal.percentage
        } else {
          return dataOuterRadius
        }
      },
      levelsAnnotated: ({levels, innerRadius, dataOuterRadius}) => {
        let levelsAnnotated = []
        let total = 0
        let count = 0
        for (let level of levels) {
          count++
          total += level.portion
        }
        let dataRangeRadius = dataOuterRadius - innerRadius
        let lastAnnotatedLevel = null
        let i = 0
        for (let level of levels) {
          let currentAnnotatedLevel = {}
          if (lastAnnotatedLevel) {
            currentAnnotatedLevel.innerRadius = lastAnnotatedLevel.outerRadius
            currentAnnotatedLevel.opacity = (count - i - 1) / (count - 1)
          } else {
            currentAnnotatedLevel.innerRadius = innerRadius
            currentAnnotatedLevel.opacity = 1
          }
          currentAnnotatedLevel.outerRadius = currentAnnotatedLevel.innerRadius + dataRangeRadius * (level.portion / total)
          levelsAnnotated.push(currentAnnotatedLevel)
          lastAnnotatedLevel = currentAnnotatedLevel
          i++
        }
        return levelsAnnotated
      },
    },

    components: {
      Arc: './Arc.html',
      Goal: './Goal.html',
    },

  }

</script>
